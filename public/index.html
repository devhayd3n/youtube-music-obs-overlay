<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Now Playing - Volcano Overlay</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: transparent;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .overlay-container {
      position: relative;
      display: flex;
      align-items: center;
      padding: 24px 36px;
      background: radial-gradient(circle at center, rgba(40, 0, 0, 0.95), rgba(10, 0, 0, 0.85));
      border: 4px solid #ff3300;
      border-radius: 20px;
      box-shadow: 0 0 30px #ff2200, inset 0 0 20px #8b0000;
      max-width: 800px;
      z-index: 2;
      overflow: hidden;
    }

    .overlay-container::before {
      content: '';
      position: absolute;
      inset: -5px;
      border-radius: 25px;
      background: linear-gradient(90deg, #ff3300, #ff1100, #ff3300);
      z-index: -1;
      opacity: 0.25;
      animation: pulseBorder 4s ease-in-out infinite;
    }

    @keyframes pulseBorder {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.5); }
    }

    #art {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 12px;
      border: 4px solid #ff5500;
      box-shadow: 0 0 20px #ff2200;
      margin-right: 28px;
      z-index: 2;
    }

    .text-info {
      display: flex;
      flex-direction: column;
      max-width: 600px;
      z-index: 2;
    }

    #title {
      font-size: 2.4rem;
      font-weight: bold;
      color: #fff8b3;
      text-shadow: 0 0 6px #ff5500, 0 0 15px #ff2200;
    }

    #artist {
      font-size: 1.6rem;
      color: #ffeedd;
      margin-top: 10px;
      text-shadow: 0 0 5px #ff3300;
    }

    /* Fire ember particles INSIDE the overlay */
    .fire-particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }

    .ember {
      position: absolute;
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, #ff6600 0%, transparent 80%);
      border-radius: 50%;
      animation: fall 5s linear infinite;
      opacity: 0.5;
    }

    @keyframes fall {
      0% {
        transform: translateY(-10px) scale(1);
        opacity: 0.6;
      }
      100% {
        transform: translateY(160px) scale(0.3);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="overlay-container" id="nowPlaying">
    <!-- Fire animation inside overlay -->
    <div class="fire-particles" id="ember-container"></div>

    <img id="art" src="" />
    <div class="text-info">
      <div id="title">Now Playing</div>
      <div id="artist">Loading...</div>
    </div>
  </div>

  <script>
    async function fetchSong() {
      try {
        const res = await fetch('http://localhost:3000/now-playing');
        const data = await res.json();

        document.getElementById('title').innerText = data.title || 'Unknown Title';
        document.getElementById('artist').innerText = data.artist || 'Unknown Artist';
        document.getElementById('art').src = data.albumArt || 'https://placehold.co/600x400';
      } catch (err) {
        console.error('Error fetching song:', err);
      }
    }

    setInterval(fetchSong, 2000);

    // Ember animation generator (inside the overlay only)
    const emberContainer = document.getElementById('ember-container');

    function createEmber() {
      const ember = document.createElement('div');
      ember.classList.add('ember');
      ember.style.left = `${Math.random() * 100}%`;
      ember.style.animationDuration = `${3 + Math.random() * 3}s`;
      ember.style.opacity = `${0.3 + Math.random() * 0.4}`;
      emberContainer.appendChild(ember);

      setTimeout(() => {
        ember.remove();
      }, 5000);
    }

    // Generate embers continuously inside the overlay
    setInterval(() => {
      createEmber();
    }, 150);
  </script>
</body>
</html>
